(()=>{var e={};e.id=1060,e.ids=[1060],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16608:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(60687),a=r(43210),n=r(74596),i=r(6211),o=r(44493),d=r(96834),l=r(42692),c=r(77368),u=r(11516),m=r(82614);let h=(0,m.A)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),p=(0,m.A)("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);var x=r(63213),f=r(29523),y=r(45826),j=r(20119);function v(){let[e,t]=(0,a.useState)([]),[r,m]=(0,a.useState)(!0),[v,g]=(0,a.useState)([]),[N,b]=(0,a.useState)(new Date),{currentUser:A}=(0,x.A)(),w=async()=>{if(A){m(!0);try{let e=await fetch("/api/orders"),r=await e.json();t(r.orders.filter(e=>"Completed"===e.status));let s=await fetch("/api/tables"),a=await s.json();g(a.tables),b(new Date)}catch(e){console.error("Error fetching data:",e)}finally{m(!1)}}else t([]),g([]),m(!1)},S=e=>{let t=v.find(t=>t.id===e);return t?t.status:"Unknown"};return(0,s.jsx)(n.AppLayout,{pageTitle:"Order History",children:(0,s.jsx)("div",{className:"ml-0 md:ml-64 transition-all",children:(0,s.jsxs)(o.Zp,{children:[(0,s.jsx)(o.aR,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(o.ZB,{children:"Completed Orders"}),(0,s.jsx)(o.BT,{children:"Review all past completed transactions for your restaurant."})]}),(0,s.jsxs)(f.$,{variant:"outline",size:"sm",onClick:w,disabled:r,children:[(0,s.jsx)(c.A,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"Refresh"]})]})}),(0,s.jsx)(o.Wu,{children:r?(0,s.jsxs)("div",{className:"flex justify-center items-center h-64",children:[(0,s.jsx)(u.A,{className:"h-8 w-8 animate-spin text-primary"}),(0,s.jsx)("p",{className:"ml-2",children:"Loading order history..."})]}):0===e.length?(0,s.jsx)("p",{className:"text-center text-muted-foreground py-8",children:"No completed orders found."}):(0,s.jsx)(l.F,{className:"h-[calc(100vh-18rem)]",children:(0,s.jsxs)(i.XI,{children:[(0,s.jsxs)(i.r6,{children:["A list of all completed orders. Last updated: ",N.toLocaleTimeString()]}),(0,s.jsx)(i.A0,{children:(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nd,{className:"w-[150px]",children:"Order ID"}),(0,s.jsx)(i.nd,{children:"Type"}),(0,s.jsx)(i.nd,{children:"Channel"}),(0,s.jsx)(i.nd,{children:"Details (Table/Customer)"}),(0,s.jsx)(i.nd,{children:"Date Completed"}),(0,s.jsx)(i.nd,{className:"text-right",children:"Total Amount"}),(0,s.jsx)(i.nd,{className:"text-center",children:"Status"}),(0,s.jsx)(i.nd,{className:"text-center",children:"Items"})]})}),(0,s.jsx)(i.BF,{children:e.map((e,t)=>{let r,a;return A&&function(e,t){let r=`deducted_orders_${e}`,s=JSON.parse(localStorage.getItem(r)||"[]");if(s.includes(t.id))return;let a=(0,j.x7)(e),n=(0,y.ZK)(e);if(!a||0===a.length||!n||0===n.length)return;let i=[];for(let e of t.items||[]){let t=a.find(t=>t.name===e.name);if(t&&Array.isArray(t.ingredients))for(let r of t.ingredients){var o,d;let t="string"==typeof r?r:r.inventoryItemName||((o=r)&&"object"==typeof o&&"name"in o&&"string"==typeof o.name?r.name:""),s="string"==typeof r?1:r.quantityPerDish||((d=r)&&"object"==typeof d&&"quantity"in d&&"number"==typeof d.quantity?r.quantity:1),a=n.findIndex(e=>e.name.toLowerCase()===t.toLowerCase());if(-1!==a){let r=n[a],o=s*(e.quantity||1);i.push({idx:a,name:t,required:o,available:r.quantity??0,unit:r.unit})}}}if(!i.find(e=>e.available<e.required)){for(let e of i){let t=n[e.idx];t.quantity=(t.quantity??0)-e.required,t.quantityUsed=(t.quantityUsed||0)+e.required,t.totalUsed=(t.totalUsed||0)+e.required}localStorage.setItem("inventory_"+e,JSON.stringify(n)),localStorage.setItem(r,JSON.stringify([...s,t.id]))}}(A.id,e),(0,s.jsxs)(i.Hj,{children:[(0,s.jsx)(i.nA,{className:"font-medium truncate max-w-[150px] block",title:e.id,children:e.id}),(0,s.jsx)(i.nA,{children:"delivery"===e.orderType||"home-delivery"===e.orderType?(0,s.jsxs)(d.E,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[(0,s.jsx)(h,{className:"h-3.5 w-3.5"}),"Delivery"]}):"take-away"===e.orderType?(0,s.jsxs)(d.E,{variant:"destructive",className:"flex items-center gap-1 w-fit",children:[(0,s.jsx)(p,{className:"h-3.5 w-3.5"}),"Take Away"]}):(0,s.jsxs)(d.E,{variant:"outline",className:"flex items-center gap-1 w-fit",children:[(0,s.jsx)(p,{className:"h-3.5 w-3.5"}),"Dine-In"]})}),(0,s.jsx)(i.nA,{children:e.channel||"Others"}),(0,s.jsx)(i.nA,{children:"delivery"===e.orderType||"home-delivery"===e.orderType?(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("p",{className:"font-medium",children:e.customerName??e.customerInfo?.name??""}),(0,s.jsx)("p",{className:"text-muted-foreground",children:e.customerAddress??e.customerInfo?.address??""})]}):"take-away"===e.orderType?(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsx)("p",{className:"font-medium",children:e.customerInfo?.name??e.customerName??"Unknown"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:e.customerInfo?.phone??"No phone"})]}):(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Table: ",e.table??e.customerInfo?.tableNumber??""]}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Status: ",S(e.table??e.customerInfo?.tableNumber??"")]})]})}),(0,s.jsx)(i.nA,{children:e.completedAt?new Date(e.completedAt).toLocaleString():new Date(e.createdAt).toLocaleDateString()+" (Pending)"}),(0,s.jsx)(i.nA,{className:"text-right",children:(r=!1,a=0,(e.items.forEach(e=>{let t=e.unitPrice&&e.unitPrice.toString().trim()?e.unitPrice:e.name&&e.name.match(/(\d+[.,]?\d*)\s*(EUR|€)/i)?.[0];if(t&&/(EUR|€)/i.test(t.toString())){r=!0;let s=t.toString().match(/(\d+[.,]?\d*)/);s&&(a+=parseFloat(s[1].replace(",","."))*e.quantity)}}),r)?`€${a.toFixed(2)}`:`$${("number"==typeof e.totalAmount&&!isNaN(e.totalAmount)?e.totalAmount:parseFloat(e.totalAmount)||0).toFixed(2)}`)}),(0,s.jsx)(i.nA,{className:"text-center",children:(0,s.jsx)(d.E,{variant:"Completed"===e.status?"default":"secondary",children:e.status})}),(0,s.jsx)(i.nA,{className:"text-center",children:e.items.reduce((e,t)=>e+t.quantity,0)})]},e.id||`order-${t}`)})})]})})})]})})})}},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44098:(e,t,r)=>{Promise.resolve().then(r.bind(r,56718))},56718:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(12907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx","default")},56959:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>l});var s=r(65239),a=r(48088),n=r(88170),i=r.n(n),o=r(30893),d={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let l={children:["",{children:["order-history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,56718)),"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,94431)),"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,57398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,89999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,65284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,c=["/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},m=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/order-history/page",pathname:"/order-history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},62250:(e,t,r)=>{Promise.resolve().then(r.bind(r,16608))},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79551:e=>{"use strict";e.exports=require("url")}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,6724,9994,1658,5814,5047,4185,9548,4592,8881,832,5799],()=>r(56959));module.exports=s})();