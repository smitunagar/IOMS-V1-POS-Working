(()=>{var e={};e.id=7947,e.ids=[7947],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},55315:e=>{"use strict";e.exports=require("path")},17360:e=>{"use strict";e.exports=require("url")},75941:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d}),r(74090),r(40247),r(35866);var s=r(23191),a=r(88716),i=r(37922),n=r.n(i),l=r(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let d=["",{children:["order-history",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,74090)),"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx"]}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,40247)),"/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,35866,23)),"next/dist/client/components/not-found-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,73881))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx"],m="/order-history/page",u={require:r,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/order-history/page",pathname:"/order-history",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},12811:(e,t,r)=>{Promise.resolve().then(r.bind(r,67022))},67022:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var s=r(10326),a=r(17577),i=r(78290),n=r(41156),l=r(29752),o=r(38443),d=r(3236),c=r(31798),m=r(46721),u=r(9664);let h=(0,u.Z)("Car",[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]]),p=(0,u.Z)("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12a2 2 0 0 1-2-2V7",key:"6c3vgh"}]]);var x=r(94001),y=r(91664),f=r(37084),j=r(24232);function g(){let[e,t]=(0,a.useState)([]),[r,u]=(0,a.useState)(!0),[g,v]=(0,a.useState)([]),[N,w]=(0,a.useState)(new Date),{currentUser:S}=(0,x.a)(),b=async()=>{if(S){u(!0);try{let e=await fetch("/api/orders"),r=await e.json();t(r.orders.filter(e=>"Completed"===e.status));let s=await fetch("/api/tables"),a=await s.json();v(a.tables),w(new Date)}catch(e){console.error("Error fetching data:",e)}finally{u(!1)}}else t([]),v([]),u(!1)},k=e=>{let t=g.find(t=>t.id===e);return t?t.status:"Unknown"};return s.jsx(i.AppLayout,{pageTitle:"Order History",children:s.jsx("div",{className:"ml-0 md:ml-64 transition-all",children:(0,s.jsxs)(l.Zb,{children:[s.jsx(l.Ol,{children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[s.jsx(l.ll,{children:"Completed Orders"}),s.jsx(l.SZ,{children:"Review all past completed transactions for your restaurant."})]}),(0,s.jsxs)(y.z,{variant:"outline",size:"sm",onClick:b,disabled:r,children:[s.jsx(c.Z,{className:`h-4 w-4 mr-2 ${r?"animate-spin":""}`}),"Refresh"]})]})}),s.jsx(l.aY,{children:r?(0,s.jsxs)("div",{className:"flex justify-center items-center h-64",children:[s.jsx(m.Z,{className:"h-8 w-8 animate-spin text-primary"}),s.jsx("p",{className:"ml-2",children:"Loading order history..."})]}):0===e.length?s.jsx("p",{className:"text-center text-muted-foreground py-8",children:"No completed orders found."}):s.jsx(d.x,{className:"h-[calc(100vh-18rem)]",children:(0,s.jsxs)(n.iA,{children:[(0,s.jsxs)(n.Rn,{children:["A list of all completed orders. Last updated: ",N.toLocaleTimeString()]}),s.jsx(n.xD,{children:(0,s.jsxs)(n.SC,{children:[s.jsx(n.ss,{className:"w-[150px]",children:"Order ID"}),s.jsx(n.ss,{children:"Type"}),s.jsx(n.ss,{children:"Channel"}),s.jsx(n.ss,{children:"Details (Table/Customer)"}),s.jsx(n.ss,{children:"Date Completed"}),s.jsx(n.ss,{className:"text-right",children:"Total Amount"}),s.jsx(n.ss,{className:"text-center",children:"Status"}),s.jsx(n.ss,{className:"text-center",children:"Items"})]})}),s.jsx(n.RM,{children:e.map((e,t)=>{let r,a;return S&&function(e,t){let r=`deducted_orders_${e}`,s=JSON.parse(localStorage.getItem(r)||"[]");if(s.includes(t.id))return;let a=(0,j.HM)(e),i=(0,f.$v)(e);if(!a||0===a.length||!i||0===i.length)return;let n=[];for(let e of t.items||[]){let t=a.find(t=>t.name===e.name);if(t&&Array.isArray(t.ingredients))for(let r of t.ingredients){let t="string"==typeof r?r:r.inventoryItemName||(r&&"object"==typeof r&&"name"in r&&"string"==typeof r.name?r.name:""),s="string"==typeof r?1:r.quantityPerDish||(r&&"object"==typeof r&&"quantity"in r&&"number"==typeof r.quantity?r.quantity:1),a=i.findIndex(e=>e.name.toLowerCase()===t.toLowerCase());if(-1!==a){let r=i[a],l=s*(e.quantity||1);n.push({idx:a,name:t,required:l,available:r.quantity??0,unit:r.unit})}}}if(!n.find(e=>e.available<e.required)){for(let e of n){let t=i[e.idx];t.quantity=(t.quantity??0)-e.required,t.quantityUsed=(t.quantityUsed||0)+e.required,t.totalUsed=(t.totalUsed||0)+e.required}localStorage.setItem("inventory_"+e,JSON.stringify(i)),localStorage.setItem(r,JSON.stringify([...s,t.id]))}}(S.id,e),(0,s.jsxs)(n.SC,{children:[s.jsx(n.pj,{className:"font-medium truncate max-w-[150px] block",title:e.id,children:e.id}),s.jsx(n.pj,{children:"delivery"===e.orderType||"home-delivery"===e.orderType?(0,s.jsxs)(o.C,{variant:"secondary",className:"flex items-center gap-1 w-fit",children:[s.jsx(h,{className:"h-3.5 w-3.5"}),"Delivery"]}):"take-away"===e.orderType?(0,s.jsxs)(o.C,{variant:"destructive",className:"flex items-center gap-1 w-fit",children:[s.jsx(p,{className:"h-3.5 w-3.5"}),"Take Away"]}):(0,s.jsxs)(o.C,{variant:"outline",className:"flex items-center gap-1 w-fit",children:[s.jsx(p,{className:"h-3.5 w-3.5"}),"Dine-In"]})}),s.jsx(n.pj,{children:e.channel||"Others"}),s.jsx(n.pj,{children:"delivery"===e.orderType||"home-delivery"===e.orderType?(0,s.jsxs)("div",{className:"text-xs",children:[s.jsx("p",{className:"font-medium",children:e.customerName??e.customerInfo?.name??""}),s.jsx("p",{className:"text-muted-foreground",children:e.customerAddress??e.customerInfo?.address??""})]}):"take-away"===e.orderType?(0,s.jsxs)("div",{className:"text-xs",children:[s.jsx("p",{className:"font-medium",children:e.customerInfo?.name??e.customerName??"Unknown"}),s.jsx("p",{className:"text-muted-foreground",children:e.customerInfo?.phone??"No phone"})]}):(0,s.jsxs)("div",{className:"text-xs",children:[(0,s.jsxs)("p",{className:"font-medium",children:["Table: ",e.table??e.customerInfo?.tableNumber??""]}),(0,s.jsxs)("p",{className:"text-muted-foreground",children:["Status: ",k(e.table??e.customerInfo?.tableNumber??"")]})]})}),s.jsx(n.pj,{children:e.completedAt?new Date(e.completedAt).toLocaleString():new Date(e.createdAt).toLocaleDateString()+" (Pending)"}),s.jsx(n.pj,{className:"text-right",children:(r=!1,a=0,(e.items.forEach(e=>{let t=e.unitPrice&&e.unitPrice.toString().trim()?e.unitPrice:e.name&&e.name.match(/(\d+[.,]?\d*)\s*(EUR|€)/i)?.[0];if(t&&/(EUR|€)/i.test(t.toString())){r=!0;let s=t.toString().match(/(\d+[.,]?\d*)/);s&&(a+=parseFloat(s[1].replace(",","."))*e.quantity)}}),r)?`€${a.toFixed(2)}`:`$${("number"!=typeof e.totalAmount||isNaN(e.totalAmount)?parseFloat(e.totalAmount)||0:e.totalAmount).toFixed(2)}`)}),s.jsx(n.pj,{className:"text-center",children:s.jsx(o.C,{variant:"Completed"===e.status?"default":"secondary",children:e.status})}),s.jsx(n.pj,{className:"text-center",children:e.items.reduce((e,t)=>e+t.quantity,0)})]},e.id||`order-${t}`)})})]})})})]})})})}},74090:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(68570).createProxy)(String.raw`/Users/nishantchaturvedi/Desktop/IOMS/IOMS-V1-POS-Working/src/app/order-history/page.tsx#default`)}};var t=require("../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,2739,6621,434,489,268,4271,7719,9599,3593,4908],()=>r(75941));module.exports=s})();